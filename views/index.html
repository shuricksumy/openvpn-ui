{{ template "layout/base.html" . }}

{{define "head"}}
<title>OpenVPN</title>
<meta http-equiv="refresh" content="60">
{{end}}

{{define "body"}}

{{$prefixURL := .PrefixURL}}

{{ if not .IsVPNSetup }}
<div class="row">
  <div class="col-md-12 col-sm-18 col-xs-36">
    <div class="info-box" style="min-height: 50px;">
    <a href="{{urlfor "WizardController.Step1Get"}}"  
      class="col-md-12 btn btn-md btn-group-xs bg-gradient-red">
        OpenVPN needs to be setup. Click to run wizard !</a>
      </div>
  </div>
</div>
{{end}}

<div class="row">
  <div class="col-md-3 col-sm-6 col-xs-12">
    <div class="info-box" style="min-height: 85px;">
      <span class="info-box-icon bg-gradient-lightblue" style="width: 80px; font-size: 3rem;">
        <i class="fa-solid fa-satellite-dish"></i>
      </span>
      <div class="info-box-content font75">
        <span class="info-box-text">
          Clients count: <span class="info-box-number2">{{ .ovstats.NClients }}</span>
        </span>
        <span class="info-box-text">
          In: <span class="info-box-number2">{{ printmb .ovstats.BytesIn }} MB</span>
        </span>
        <span class="info-box-text">
          Out: <span class="info-box-number2">{{ printmb .ovstats.BytesOut }} MB </span>
        </span>
      </div>
      <!-- /.info-box-content -->
    </div>
    <!-- /.info-box -->
  </div>
  <!-- /.col -->

    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="info-box" style="min-height: 85px;">
        <span class="info-box-icon bg-gradient-lightblue" style="width: 80px; font-size: 3rem;">
          <i class="fa-solid fa-chart-simple"></i>
        </span>
        <div class="info-box-content font75">
          <span class="info-box-text">Load Average:</span>
          <span class="info-box-number">
            {{ .sysinfo.LoadAvg.One }},
            {{ .sysinfo.LoadAvg.Five }},
            {{ .sysinfo.LoadAvg.Fifteen }}<br/>
            </span>
          <span class="info-box-text font90">
            CPU count: <span class="info-box-number2">
              {{ .sysinfo.CPUList.List | len }}
            </span>
          </span>
        </div>
        <!-- /.info-card-content -->
      </div>
      <!-- /.info-card -->
    </div>
    <!-- /.col -->


    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="info-box" style="min-height: 85px;">
        <span class="info-box-icon bg-gradient-lightblue" style="width: 80px; font-size: 3rem;">
          <i class="fa-regular fa-lightbulb"></i>
        </span>
        <div class="info-box-content">
          <span class="info-box-text">OS uptime:</span>
          <span class="info-box-number">{{ .sysinfo.UptimeS }}</span>
        </div>
        <!-- /.info-card-content -->
      </div>
      <!-- /.info-card -->
    </div>
    <!-- /.col -->

    <div class="col-md-3 col-sm-6 col-xs-12" >
      <div class="info-box" style="min-height: 85px;">
        <span class="info-box-icon bg-gradient-lightblue" style="width: 80px; font-size: 3rem;">
          <i class="fa-regular fa-clock"></i>
        </span>
        <div class="info-box-content">
          <span class="info-box-text">
            Server time:
          </span>
          <span class="info-box-number font90">
              {{ dateformat .sysinfo.CurrentTime "2006-01-02 15:04:05"}}
          </span>
        </div>
        <!-- /.info-card-content -->
      </div>
      <!-- /.info-card -->
    </div>
    <!-- /.col -->


</div>
<!-- /.row -->

<div class="row">
  <div class="col-md-12">
    <div class="card card-default">
      <!-- <div class="card-body">-->
        <div class="float-container">
          <div class="float-child-no-border">
            <div class="col-md-12">
              <div class="progress-group">
                <span class="progress-text">Memory</span>
                <span class="progress-number">
                  <b>{{ printmb .sysinfo.Memory.Used }}</b> / {{ printmb .sysinfo.Memory.Total }} MB - {{percent .sysinfo.Memory.Used .sysinfo.Memory.Total}}%
                </span>
                <div class="progress sm">
                  <div class="progress-bar bg-gradient-lightblue"
                    style="width: {{percent .sysinfo.Memory.Used .sysinfo.Memory.Total}}%"></div>
                </div>
              </div>
            </div>
          </div>
              <!-- /.col -->
          <div class="float-child-no-border">
            <div class="col-md-12">
              <div class="progress-group">
                <span class="progress-text">Swap</span>
                <span class="progress-number">
                  <b>{{ printmb .sysinfo.Swap.Used }}</b> / {{ printmb .sysinfo.Swap.Total }} MB - {{percent .sysinfo.Swap.Used .sysinfo.Swap.Total}}%
                </span>

                <div class="progress sm">
                  <div class="progress-bar bg-gradient-red"
                    style="width: {{percent .sysinfo.Swap.Used .sysinfo.Swap.Total}}%">
                  </div>
                </div>

              </div>
              </div>
            </div>
          <!-- /.col -->
          <div>
          <!-- float cont -->
      </div>
      <!-- /.card-body -->
      <!--    </div>-->
    <!-- /.card -->
  </div>
  <!-- /.col -->
</div>

<div class="row">
  <div class="col-md-12">
    <div class="card card-lightblue">
      <div class="card-header with-border">
        <h3 class="card-title">Connected clients</h3>
      </div>
      <!-- /.card-header -->

      <div class="card-body p-0">
        {{if .ovstatus}}
        <div class="table-responsive">
          <table class="table table-sm m-0" id="connections" style="width:100%">
            <thead>
            <tr class="font90">
              <th>Common Name</th>
              <th>Real Address</th>
              <th>Virtual Address</th>
              <th>KB Received</th>
              <th>KB Sent</th>
              <th>Connected Since</th>
              <th>Username</th>
              <th>Disconnect</th>
            </tr>
            </thead>
            <tbody>

            {{range .ovstatus.ClientList}}
            <tr>
              <td><span class="btn btn-xs btn-group-xs bg-lightblue btn120">{{.CommonName}}</span></td>
              <td><span class="badge bg-gray-light btn150">{{.RealAddress}}</span></td>
              <td>
                <span class="badge bg-olive btn100">{{.VirtualAddress}}</span>
              </td>
              <td>
                <span class="badge bg-gray-light btn100">{{printkb .BytesReceived}}</span>
              </td>
              <td>
                <span class="badge bg-gray-light btn100">{{printkb .BytesSent}}</span>
              </td>
              <td><span class="badge bg-gray-light btn120">{{.ConnectedSince}}</span></td>
              <td><span class="badge bg-gray-light btn120">
                  {{if eq .Username "UNDEF"}}
                    -
                  {{else}}
                    {{.Username}}
                  {{end}}
                </span></td>
              <td class="textcenter">
                <a href="javascript:$.MyAPP.Disconnect('{{.CommonName}}','{{$prefixURL}}')"
                   data-title="Disconect {{.CommonName}} client ?"
                   class="btn btn-xs btn-group-xs btn-danger bg-red-gradient btn24"
                   title="Disconnect">X</a>
              </td>
            </tr>
            {{end}}

            </tbody>
          </table>
        </div>
        <!-- /.table-responsive -->
      {{else}}
        <a href="{{urlfor "SystemController.Get"}}" class="col-md-12 btn btn-md btn-group-xs bg-gradient-red">Fix your configuration or restart OpenVPN</a>
      {{end}}
      </div>
      <!-- /.card-footer -->
    </div>
    <!-- /.card -->
  </div>
</div>
<!-- /.col -->
<!-- /.card-body -->

<div class="row">
  <div class="col-md-6 col-sm-12 col-xs-12">
    <div class="info-box" style="min-height: 75px;">
      <span class="info-box-icon bg-gradient-olive" style="width: 75px; font-size: 2rem;">
        <i class="fa-solid fa-info"></i>
      </span>
      <div class="info-box-content font75">
      </span>
      <span class="info-box-text3">
        OpenVPN version: <span class="info-box-number font75">{{ .ovversion }}
      </span>
      </div>
      <!-- /.info-card-content -->
    </div>
    <!-- /.info-card -->
  </div>
  <!-- /.col -->

  <div class="col-md-6 col-sm-12 col-xs-12">
    <div class="info-box" style="min-height: 75px;">
      <span class="info-box-icon bg-gradient-olive" style="width: 75px; font-size: 2rem;">
        <i class="fa-solid fa-gears"></i>
      </span>
      <div class="info-box-content font75">
        <div class="btn-group">
          <span class="info-box-text">Operating system:</span><span class="info-box-number2">{{ .sysinfo.Os }}</span>
        </div>
        <div class="btn-group">
          <span class="info-box-text">Architecture: </span><span class="info-box-number2">{{ .sysinfo.Arch }} </span>
        </div>
      </div>
      <!-- /.info-card-content -->
    </div>
    <!-- /.info-card -->
  </div>
  <!-- /.col -->

  <!-- fix for small devices only -->
  <div class="clearfix visible-sm-block"></div>
  <!-- /.col -->
</div>
<!-- /.row -->

{{end}}

<script type="text/javascript">
  $(document).ready(function () {

    new DataTable('#connections', {
      lengthMenu: [
        [8, 15, 30, -1],
        [8, 15, 30, "All"],
      ],
      paging: true,
      // scrollY: 500,
      columnDefs: [
        { targets: [0, 1, 2, 6], searchable: true },
        { targets: '_all', type: 'html', searchable: false }
      ],
      language: {
        "emptyTable": "No data available in table",
        "lengthMenu": "_MENU_ items on a page",
        "info": "Showing _START_ to _END_ of _TOTAL_ entries",
        "infoEmpty": "Showing 0 to 0 of 0 entries",
        "search": "",
        "paginate": {
          "first": "<<",
          "last": ">>",
          "next": ">",
          "previous": "<"
        },
      },
      layout: {
        topEnd: 'info',
        topStart: {
          search: {
            placeholder: 'Type search here'
          }
        },
        bottomStart: 'pageLength',
        bottomEnd: {
          paging: {
            numbers: 3
          }
        }
      }
    });
  });
</script>