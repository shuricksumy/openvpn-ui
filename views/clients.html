{{ template "layout/base.html" . }}

{{define "head"}}
<title>OpenVPN - Certificates</title>
{{end}}

{{define "body"}}


<!-- /.card-header -->
{{template "common/alert.html" .}}
<div class="col-xs-12">
  <div class="card">
    <div class="card-header">
      <table>
        <thead>
          <th style="width:80%"></th>
          <th style="width:10%"></th>
          <th style="width:10%"></th>
        </thead>
        
        <tbody>
        <tr>
          <td class="font90">
              <i>If you finish working on clients details, do not forget to apply these changes for ALL clients and restart server. &nbsp;&nbsp;</i>
          </td><td class="text-right">
              <a href="{{urlfor "ClientsController.UpdateFiles"}}" class="btn btn-warning btn-sm btn-group-sm bg-gradient-yellow btn150"
              data-title="Update ALL Clients?" title="Apply Clients Configuration" style="margin-right: 23px;">Apply Configurations</a>
          </td><td class="text-right">
              <a href="{{urlfor "ClientsController.Restart"}}" class="btn btn-danger btn-sm btn-group-sm bg-gradient-red btn150" data-title="Restart OpenVPN container?" 
                    title="Restart OpenVPN container" style="margin-right: 23px;">Restart Server</a>
          </td>
        </tr>
      </tbody>
      </table>
    </div>
  </div>
</div>

<!-- <div class="row"> -->
  <div class="col-xs-12">
    <div class="card card-lightblue">
      <div class="card-header with-border">
        <h3 class="card-title">Clients details</h3>
      </div>

      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table-sm table-bordered table-hover m-0">
            <thead>
            <tr class="font90">
              <th style="width:5%" class="first-sm">Client Name</th>
              <th style="width:2%">DefR</th>
              <th style="width:5%">Static IP</th>
              <th style="width:5%">IsRouter</th>
              <th class="textcenter" style="width:30%">Description</th>
              <th class="textcenter" style="width:50%">Route List</th>
              <th class="textcenter last-sm" style="width:3%">File</th>
            </tr>
            </thead>
            <tbody>

            {{$MD5 := .MD5}}
            
            {{range $c := .clients}}
              <tr data-widget="expandable-table" aria-expanded="false">

                  <!-- 1 sell -->
                  <td class="my-centered first-sm">
                      {{ $col := "btn-sm btn-group-sm btn-block bg-gradient-lightblue" }} 
                      {{ $comment := .ClientName }}
                      {{ $icon := "fa fa-edit" }}
                      {{ range $md5 := $MD5 }}
                          {{ if eq $md5.ClientName $c.ClientName }}
                              {{ if not $md5.IsValid }} 
                                  {{ $col = "btn-danger btn-sm btn-group-sm btn-block bg-gradient-red" }} 
                                  {{ $comment = "Config was changed but not applied !" }}
                                  {{ $icon = "fa fa-warning" }} 
                              {{ end }}
                          {{ end }}
                      {{ end }}
                       <button id="openModalEditClientRaw" data-target="#editClientModalRaw" data-client-name="{{ .ClientName }}" 
                        class="btn {{ $col }} right-icon-holder font75" 
                        title="{{ $comment }}">{{ .ClientName }}<i class="{{ $icon }}"></i>
                      </button>
                  </td>

                  <!-- 2 sell -->
                  <td class="my-centered first-cap">
                    {{ if .IsRouteDefault }}
                      <span class="btn btn-xs btn-group-xs bg-gradient-olive btn40">{{ .IsRouteDefault }}</span>
                    {{else}}
                      <span class="btn btn-xs bg-gray-light btn-group-xs btn40">{{ .IsRouteDefault }}</span>
                    {{end}}
                  </td>

                  <!-- 3 sell -->
                  <td class="my-centered">
                    {{ if ne .StaticIP "" }}
                      <span class="btn btn-xs btn-group-xs bg-gradient-olive btn80">{{ .StaticIP }}</span>
                    {{else}}
                      <span class="btn btn-xs btn-group-xs bg-gray-light btn80">random</span>
                    {{end}}
                  </td>


                  <!-- 5 sell -->
                  <td class="my-centered">
                    {{ if .IsRouter }}
                      <span class="btn btn-xs btn-group-xs bg-gradient-purple btn80">{{ .RouterSubnet }}</span>
                      <!-- <span class="btn btn-xs bg-purple btn80">{{ .RouterMask }}</span> -->
                    {{else}}
                      <span class="btn btn-xs btn-group-xs bg-gray-light btn80">-</span>
                    {{end}}
                  </td>

                  <!-- 6 sell -->
                  <td class="first-cap font75">
                    {{ .Description }}
                  </td>


                  <!-- 7 sell -->
                  <td>
                    {{range $i, $val := .RouteList}}
                      <span class="btn btn-xs btn-group-xs bg-gradient-olive bnt24">{{ $val }}</span>
                      {{ if ge $i 3}}<span class="btn btn-xs btn-group-xs bg-gradient-olive bnt40">...</span>{{end}}
                    {{end}}
                    {{range  $val := .RouteListUnselected}}
                      <span class="btn btn-xs btn-group-xs bg-gray-light bnt24">{{ $val }}</span>
                    {{end}}
                    <button type="button" class="btn btn-primary p-0">
                      <i class="expandable-table-caret fas fa-caret-right fa-fw"></i>
                    </button>
                  </td>

                  <!-- 8 sell -->
                  <td class="textcenter my-centered last-sm">
                    <div class="btn-group" role="group">
                        <button  id="openModalEditClientDetails" data-target="#editClientDetailsModal" data-client-name="{{ .ClientName }}"
                        class="btn btn-sm btn-group-sm bg-gradient-lightblue btn80 font75" title="Edit">Edit</button>
                        <!-- <button id="openModalEditClientRaw" data-target="#editClientModalRaw" data-client-name="{{ .ClientName }}" 
                        class="btn btn-sm bg-light-blue-gradient btn40" title="Edit">Raw</button> -->
                    </div>
                  </td>
                </tr>
                <tr class="expandable-body d-none">
                  <td colspan="6">
                  <div style="display: none; text-align: end;">
                    <!-- <span class="btn btn-xs btn-group-xs bg-gradient-lightblue bnt40">Routes: </span>  -->
                    {{range  $val := .RouteList}}
                      <span class="btn btn-xs btn-group-xs bg-gradient-olive bnt24">{{ $val }}</span>
                    {{end}}
                    {{range  $val := .RouteListUnselected}}
                      <span class="btn btn-xs btn-group-xs bg-gray-light bnt24">{{ $val }}</span>
                    {{end}}
                  </div>
                </td>
                </tr>
            {{end}}
            </tbody>
          </table>
        </div>
       </div>
        <!-- /.table-responsive -->
      </div>
      <!--else
          Fix your configuration
      end-->

     <!--
      <div class="card-footer clearfix">
        
      </div>
      -->

      <!--
      <div class="card-footer clearfix">
        <a href="javascript:void(0)" class="btn btn-sm btn-info btn-flat pull-left">Place New Order</a>
        <a href="javascript:void(0)" class="btn btn-sm btn-default btn-flat pull-right">View All Orders</a>
      </div>
    -->
      <!-- /.card-footer -->
    </div>
    <!-- /.card -->
  </div>

<!-- </div> -->

<script type="text/javascript">
  var actionURL="/clients/save_client_data" 
</script>

<!-- Add an empty modal container -->
<div id="modal-edit-client-details"></div>
<div id="modal-edit-client-raw"></div>

{{end}}

<div id="overlay">
  <div class="cv-spinner">
    <span class="spinner"></span>
  </div>
</div>